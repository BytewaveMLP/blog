<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on byte-sized blog</title><link>https://blog.code.horse/posts/</link><description>Recent content in Posts on byte-sized blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>(c) Eliot Partridge, 2021</copyright><lastBuildDate>Wed, 13 Oct 2021 21:55:15 -0500</lastBuildDate><atom:link href="https://blog.code.horse/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Caskading Failures</title><link>https://blog.code.horse/posts/2021-10-13-caskading-failures/</link><pubDate>Wed, 13 Oct 2021 21:55:15 -0500</pubDate><guid>https://blog.code.horse/posts/2021-10-13-caskading-failures/</guid><description>You ever have one of those days? Where everything&amp;rsquo;s falling apart and nothing makes sense? Where you&amp;rsquo;re left wondering &amp;ldquo;how did any of this ever work?&amp;rdquo;
Yeah. That was yesterday for me.
First, a little backstory. So there&amp;rsquo;s this little MLP:FIM community I&amp;rsquo;m a part of called Cider and Saddle. It&amp;rsquo;s a small bunch, only about 6 people all-told, and we&amp;rsquo;re all good friends. In that group are a couple of nerds like myself who enjoy tinkering with computers and programming.</description><content>&lt;p>You ever have one of &lt;em>those&lt;/em> days? Where everything&amp;rsquo;s falling apart and nothing makes sense? Where you&amp;rsquo;re left wondering &amp;ldquo;how did any of this ever work?&amp;rdquo;&lt;/p>
&lt;p>Yeah. That was yesterday for me.&lt;/p>
&lt;h2 id="first-a-little-backstory">First, a little backstory.&lt;/h2>
&lt;p>So there&amp;rsquo;s this little &lt;a href="https://en.wikipedia.org/wiki/My_Little_Pony:_Friendship_Is_Magic#Fandom">MLP:FIM&lt;/a> community I&amp;rsquo;m a part of called Cider and Saddle. It&amp;rsquo;s a small bunch, only about 6 people all-told, and we&amp;rsquo;re all good friends. In that group are a couple of nerds like myself who enjoy tinkering with computers and programming. Shortly after I joined CaS, us nerds got together and discussed the idea of building up a set of linked services for the community to use, backed by some kind of internal account system. The specifics of this system will definitely be the subject of a future blog post, but I&amp;rsquo;ll offer some highlights here: at the heart of our system is OpenLDAP and Keycloak, which provide LDAP- and OpenID Connect-based authentication for our services. Then, we have a few different applications up for the community to use, including &lt;a href="https://drawpile.net">Drawpile&lt;/a>, and a custom-built file-sharing application we call Cider Cask. All of these are wrapped up in Docker containers, and orchestrated with Compose. Not exactly the cleanest system, but it gets the job done.&lt;/p>
&lt;p>Cider Cask is the focus of today&amp;rsquo;s post. It was built by one of our members, who we&amp;rsquo;ll call MF. It&amp;rsquo;s a simple file drop box; users can log in and upload images and other files to the site, and receive short, shareable branded links they can post to our group&amp;rsquo;s chat or share with others. It&amp;rsquo;s a neat little project, and it&amp;rsquo;s been very nice in combination with &lt;a href="https://getsharex.com">ShareX&lt;/a> for sharing screenshots and the like. Cider Cask was built a number of months ago and, since being deployed, hasn&amp;rsquo;t really needed a lot of maintenance. At least, that was true until two weeks ago.&lt;/p>
&lt;h2 id="what-went-wrong">What went wrong?&lt;/h2>
&lt;p>In case you hadn&amp;rsquo;t heard, &lt;a href="https://letsencrypt.org/docs/dst-root-ca-x3-expiration-september-2021/">Let&amp;rsquo;s Encrypt&amp;rsquo;s root certificate expired on September 30th&lt;/a>, causing many old applications and devices to reject connections to any site secured by certificates issued by Let&amp;rsquo;s Encrypt. At Cider and Saddle, all of our services are backed by a Let&amp;rsquo;s Encrypt wildcard certificate, which we&amp;rsquo;d configured to automatically renew when needed. We thought that meant we&amp;rsquo;d be in the clear; after all, we were sure to keep our production system up-to-date, and as long as the system&amp;rsquo;s CA certificates were fresh, there shouldn&amp;rsquo;t be any issues.&lt;/p>
&lt;p>We were wrong.&lt;/p>
&lt;p>On October 3rd, one of our community members noticed Cask was throwing 500 errors upon visiting the page. Scrubbing through the logs, it was pretty easy to guess what was going on:&lt;/p>
&lt;pre tabindex="0">&lt;code>OpenSSL::SSL::SSLError (SSL_connect returned=1 errno=0 state=error: certificate verify failed (certificate has expired)):
app/services/openid_service.rb:32:in `request_access_token'
app/controllers/openid_controller.rb:25:in `auth'
&lt;/code>&lt;/pre>&lt;p>We knew from the fact that all of our other services were still online that it wasn&amp;rsquo;t the certificate itself that was the issue, so it was clear that Cider Cask&amp;rsquo;s Docker image must have a stale CAcert file. Therefore, the logical next step would be to rebuild the Docker image with an updated base image, to hopefully get fresh CA certs.&lt;/p>
&lt;p>This brought up the first issue: project rot. It had been a while since anyone had touched the Cask codebase, and in that time, a few important developments had occurred; namely, the mimemagic gem was &lt;a href="https://github.com/mimemagicrb/mimemagic/issues/97">yanked from Rubygems due to a license violation&lt;/a>. Due to this, we encountered our first hurdle, though it was fairly easily rectified by simply upgrading mimemagic. However, it required MF&amp;rsquo;s presence, as them and myself are the only developers on the CaS tech team with Ruby experience, which added additional delay to brining Cask back online. Once mimemagic was updated, we were able to rebuild the container.&lt;/p>
&lt;h2 id="permissions-hell">Permissions Hell&lt;/h2>
&lt;p>When we brought up our stack, we noticed our Cask containers were immediately crashing. Digging into the logs, we found that &lt;code>bin/rails&lt;/code> was throwing &lt;code>Permission denied&lt;/code> when trying to run after the container down-leveled its privileges. This is about when I enter the story, as before now I&amp;rsquo;d been busy with coursework, and had been unable to do any sort of deep investigation. My first instinct was to check executable permissions on the Rails binstub, since that&amp;rsquo;s the obvious answer to &lt;code>Permission denied&lt;/code>: check the permissions. But that&amp;rsquo;s when I noticed the third major issue:&lt;/p>
&lt;pre tabindex="0">&lt;code>root@container:/app/bin# ls -lah /usr/bin/env
-rwxr-xr-x 1 root root 48K Sep 24 2020 /usr/bin/env
root@container:/app/bin# su cidercask
bash-5.1$ /usr/bin/env # the shebang for bin/rails
bash: /usr/bin/env: Permission denied
bash-5.1$ ls -la bin
ls: error while loading shared libraries: libpcre2-8.so.0: cannot open shared object file: Permission denied
&lt;/code>&lt;/pre>&lt;p>&lt;em>wat.&lt;/em>&lt;/p>
&lt;p>That wasn&amp;rsquo;t supposed to happen. That couldn&amp;rsquo;t happen. Right? Surely nothing in our &lt;code>Dockerfile&lt;/code> should do anything to break something as critical as &lt;strong>Coreutils&lt;/strong> of all things. And yet, after looking at the official Debian &lt;code>slim&lt;/code> image, the official Ruby 2.6 &lt;code>slim&lt;/code> image, and &lt;a href="https://hub.docker.com/r/timbru31/ruby-node/">&lt;code>ruby-node&lt;/code>&lt;/a>&amp;rsquo;s &lt;code>2.6-slim&lt;/code> tag, I was unable to find any sort of break in the chain that would cause something like this. So if the images themselves were fine, it had to be something we were doing wrong. But&amp;hellip; what?&lt;/p>
&lt;p>It was at this point that another friend I was chatting with posed an interesting point: what about &lt;code>/usr&lt;/code>? Specifically, did I make sure that my user had search permissions for &lt;code>/usr/bin&lt;/code>? It hadn&amp;rsquo;t occurred to me that that might be an issue, since&amp;hellip; well, what&amp;rsquo;s going to change permissions of &lt;code>/usr&lt;/code> from anything other than &lt;code>755&lt;/code>? And yet&amp;hellip;&lt;/p>
&lt;pre tabindex="0">&lt;code>root@container:/app/bin# ls -la /usr
total 44
drwxrws--- 1 root root 4096 Aug 16 2020 .
drwxr-xr-x 1 root root 4096 Oct 13 03:54 ..
drwxrws--- 1 root root 4096 Aug 16 2020 bin
...
&lt;/code>&lt;/pre>&lt;p>&lt;code>750&lt;/code>? And is that&amp;hellip; a sticky bit? Where the hell did that come from? Well&amp;hellip;&lt;/p>
&lt;pre tabindex="0">&lt;code>bw81@production-host:~srv/cider-cask$ ls -la docker
...
drwxrws---+ 3 cas srv 4.0K Aug 15 2020 usr/
...
&lt;/code>&lt;/pre>&lt;p>For reference, files in &lt;code>docker/&lt;/code> were used as part of our &lt;em>development&lt;/em> Docker builds for running every component of the application inside one container using &lt;code>s6&lt;/code>. They had no real use in production, but we used one &lt;code>Dockerfile&lt;/code> for both builds (perhaps to our detriment, but that&amp;rsquo;s a topic for another time).&lt;/p>
&lt;p>So we&amp;rsquo;d found our culprit. For some reason, long ago when this server was first deployed, long before we&amp;rsquo;d even started working on the Cider and Saddle infrastructure project, these permissions had been set up this way. &lt;code>750&lt;/code>, with the sticky bit sit, and some extended ACLs that I don&amp;rsquo;t believe served any purpose. Docker had apparently copied these strange permissions over to our container image when it was built this time, despite never doing so before. Now, this was fine for most of the project files, since they were &lt;code>chown&lt;/code>ed to the &lt;code>cidercask&lt;/code> user. But &lt;code>docker/usr&lt;/code>&amp;hellip; we hadn&amp;rsquo;t thought of that. So Docker &amp;ldquo;helpfully&amp;rdquo; copied those permissions for us, which left &lt;code>/usr&lt;/code> readable only by &lt;code>root:root&lt;/code>. Which meant no searching for binaries and shared objects for any user that wasn&amp;rsquo;t &lt;code>root&lt;/code>.&lt;/p>
&lt;p>Great. There went 4 hours of my life I&amp;rsquo;ll never get back. So we reset the permissions for the &lt;code>srv&lt;/code> user&amp;rsquo;s homedir to make sure nothing like this would happen again, and rebuilt the container for what would hopefully be the last time. And with that, we brought up the stack one last time, confirmed everything was working, and all got to bed on time that night.&lt;/p>
&lt;p>&amp;hellip; I&amp;rsquo;m just kidding.&lt;/p>
&lt;pre tabindex="0">&lt;code>OpenSSL::SSL::SSLError (SSL_connect returned=1 errno=0 state=error: certificate verify failed (certificate has expired)):
app/services/openid_service.rb:32:in `request_access_token'
app/controllers/openid_controller.rb:25:in `auth'
&lt;/code>&lt;/pre>&lt;p>Goddammit.&lt;/p>
&lt;h2 id="square-one">Square One&lt;/h2>
&lt;p>So all of that was for nothing. We rebuilt the container on a completely fresh base image, one that&amp;rsquo;s used by thousands of projects, and yet somehow&amp;hellip; somehow we were still running into the Let&amp;rsquo;s Encrypt issue.&lt;/p>
&lt;p>Okay, so&amp;hellip; let&amp;rsquo;s check our CA certificates. If the image maintainers won&amp;rsquo;t update them for some reason, I guess we can always update them ourselves.&lt;/p>
&lt;pre tabindex="0">&lt;code>root@container:/app# apt-get update &amp;amp;&amp;amp; apt-get install ca-certificates
...
ca-certificates is already the newest version (20210119).
&lt;/code>&lt;/pre>&lt;p>What?! Those are fresh! Like, two-days-old fresh!&lt;/p>
&lt;p>Maybe it was an outdated version of OpenSSL? I know Debian tends to ship with fairly old versions of packages, but I would be surprised if they skimped out on keeping OpenSSL fresh.&lt;/p>
&lt;pre tabindex="0">&lt;code>root@container:/app# openssl version
OpenSSL 1.1.1k 25 Mar 2021
&lt;/code>&lt;/pre>&lt;p>That&amp;rsquo;s pretty recent. Certainly not the latest, but certainly newer than the &lt;a href="https://community.letsencrypt.org/t/openssl-client-compatibility-changes-for-let-s-encrypt-certificates/143816">1.1.0 version Let&amp;rsquo;s Encrypt warned everyone to upgrade to&lt;/a>.&lt;/p>
&lt;p>Were we somehow just&amp;hellip; missing the ISRG root CA?&lt;/p>
&lt;pre tabindex="0">&lt;code>root@container:/app# ls -lah /etc/ssl/certs | grep -i isrg
lrwxrwxrwx 1 root root 16 Sep 28 21:32 4042bcee.0 -&amp;gt; ISRG_Root_X1.pem
lrwxrwxrwx 1 root root 51 Sep 28 21:32 ISRG_Root_X1.pem -&amp;gt; /usr/share/ca-certificates/mozilla/ISRG_Root_X1.crt
&lt;/code>&lt;/pre>&lt;p>No luck. Maybe having the old, expired DST root cert around was making OpenSSL unhappy? This would violate everything I know about how certificate chain validation works, but&amp;hellip; &lt;a href="https://stackoverflow.com/a/69407814">it seems to have worked for this StackOverflow user&lt;/a>. But not even removing the DST X3 cert and rebuilding &lt;code>cacert.pem&lt;/code> fixed it.&lt;/p>
&lt;p>At this point, it was getting pretty late. Dealing with this whole mess had been pretty tiring, and it was getting hard to think straight. After jokingly suggesting to MF that we just disable SSL verification in Cask as a quick patch, I decided to put things on hold for a bit and quietly cry myself to sleep that night.&lt;/p>
&lt;h2 id="refreshed-perspective">Refreshed Perspective&lt;/h2>
&lt;p>The moment I woke up, it hit me. The OS had fresh CA certs, that much was true. But Rails is an old framework, and I know that, back in the day, we couldn&amp;rsquo;t always rely on the OS for up-to-date CA certs out-of-the-box. This led a lot of library/application maintainers to ship their own CA bundles that would hopefully be more reliable or, at the very least, more predictably located. So I started digging through code, trying to find where any HTTP calls were made, and what library they were using. I started with &lt;code>request_access_token&lt;/code>, the method which was &lt;code>raise&lt;/code>ing the error in the first place. That led me to the &lt;code>openid_connect&lt;/code> gem which, after a small amount of its own logic, wound up in &lt;code>rack-oauth2&lt;/code>, in a method which was responsible for completing the OAuth2 flow by exchanging the given authorization code from the user&amp;rsquo;s browser with the authenticating server for an access token. To complete this HTTP transaction, &lt;code>rack-oauth2&lt;/code> made use of &lt;a href="https://rubygems.org/gems/httpclient">the &lt;code>httpclient&lt;/code> gem&lt;/a>, which was last updated &lt;em>5 years ago&lt;/em>. Digging into &lt;a href="https://github.com/nahi/httpclient">its GitHub repository&lt;/a>, I quickly found the root cause of all these issues: &lt;a href="https://github.com/nahi/httpclient/blob/4658227a46f7caa633ef8036f073bbd1f0a955a2/dist_key/cacerts.pem">a &lt;code>cacert.pem&lt;/code> bundle&lt;/a> that was last updated &lt;strong>11 YEARS AGO&lt;/strong>!&lt;/p>
&lt;p>11 years is a long time. In that time, a lot has happened in the world of certificate authorities, like &lt;a href="https://security.googleblog.com/2018/03/distrust-of-symantec-pki-immediate.html">the untrusting of Symantec&amp;rsquo;s entire PKI&lt;/a> and, y&amp;rsquo;know, &lt;strong>the founding of Let&amp;rsquo;s Encrypt&lt;/strong>. Seriously, this CA bundle was from a time when Let&amp;rsquo;s Encrypt didn&amp;rsquo;t even exist! What a dark era of network security that was. When this certificate bundle was last updated, I was 10 years old, and had just finished the 4th grade.&lt;/p>
&lt;p>No wonder modern infrastructure gets breached all the time.&lt;/p>
&lt;p>Anyway. It turns out, the maintainers of &lt;code>rack-oauth2&lt;/code> had actually taken notice to this stale CA cert bundle, and released a version of &lt;code>rack-oauth2&lt;/code> to work around this issue by having &lt;code>httpclient&lt;/code> use the system&amp;rsquo;s CA bundle instead of its own. Guess when that fix was committed and released?&lt;/p>
&lt;p>&lt;a href="https://github.com/nov/rack-oauth2/commit/4a207ed785cecc15e8b20f34f9acd6094634fa30">13 days ago&lt;/a>. On the same day that the LE root cert expired. I mean&amp;hellip; I&amp;rsquo;m glad somebody finally noticed. But the fact that this 11-year-old cert bundle was—and might still be!—buried inside potentially thousands of production applications for who-knows-how-long actually scares me. Yikes.&lt;/p>
&lt;p>Anyway. On that note, we quickly upgraded &lt;code>rack-oauth2&lt;/code>, rebuilt the container, and brought up the stack for the last time. And with that, all was well. We had successfully restored Cider Cask after only&amp;hellip; 7 days of partial outage, and 6 days of total outage. Not the worst, but certainly suboptimal.&lt;/p>
&lt;h2 id="closing-thoughts">Closing Thoughts&lt;/h2>
&lt;p>It&amp;rsquo;s times like these that I remember why I both love and hate what I do. Working in software engineering/devops means you&amp;rsquo;ll inevitably be faced with those kinds of impossible problems, the ones that should never happen, could never happen, and yet are totally happening, and it&amp;rsquo;s your job to fix them. In times like those, it&amp;rsquo;s important to question everything; don&amp;rsquo;t leave any assumptions unturned, and don&amp;rsquo;t just check the usual suspects. When your infrastructure seems to be falling apart, it&amp;rsquo;s important to assume it&amp;rsquo;s already come down, and audit everything. Never assume &amp;ldquo;it can&amp;rsquo;t be X, I know it isn&amp;rsquo;t X.&amp;rdquo; Because it will be X. It&amp;rsquo;s always X. Sometimes even literally.&lt;/p>
&lt;p>But I also love these kinds of situations. Not being knee-deep in total production collapse or anything, mind you; that&amp;rsquo;s never fun. But there&amp;rsquo;s something immensely satisfying about &lt;em>figuring it out&lt;/em>, about finding the needle in the haystack, about wading neck-deep into the source code and coming out with the answer. And the deeper you go, the more exciting it is to finally be done with it.&lt;/p>
&lt;p>I&amp;rsquo;d also like to mention once again just how scary it is that &lt;code>httpclient&lt;/code>&amp;rsquo;s CA bundle has been this stale for this long. The latest release has over &lt;strong>2 million&lt;/strong> downloads on RubyGems. How many of those dependents are aware of the stale CA bundle? How many know the magic commands to get it to wipe its CA store and load the OS' defaults instead? If Let&amp;rsquo;s Encrypt&amp;rsquo;s root CA hadn&amp;rsquo;t expired recently, would anyone have noticed?&lt;/p>
&lt;p>I leave you with two important lessons: when you&amp;rsquo;re faced with that impossible problem, &lt;em>check everything&lt;/em>, no matter how silly; and for the love of God, &lt;strong>keep tabs on your dependencies&lt;/strong>, and don&amp;rsquo;t let project rot turn a stale codebase into a vulnerability.&lt;/p></content></item><item><title>From the Archives: Looking Back on sleeti</title><link>https://blog.code.horse/posts/2017-06-02-looking-back-on-sleeti/</link><pubDate>Fri, 02 Jun 2017 00:00:00 +0000</pubDate><guid>https://blog.code.horse/posts/2017-06-02-looking-back-on-sleeti/</guid><description>This article was originally published in a one-off blog post format before this blog was created. I&amp;rsquo;ve refreshed it and published it here for archival reasons.
My file sharing project sleeti is nearing its first birthday (August 5th). In celebration, I decided I was going to take a look back at the original ideas for the project, the process I went through for development, and what all I learned throughout the process of building my first big open-source piece of software.</description><content>&lt;p>&lt;strong>This article was originally published in a one-off blog post format before this blog was created. I&amp;rsquo;ve refreshed it and published it here for archival reasons.&lt;/strong>&lt;/p>
&lt;p>My file sharing project sleeti is nearing its first birthday (August 5th). In celebration, I decided I was going to take a look back at the original ideas for the project, the process I went through for development, and what all I learned throughout the process of building my first big open-source piece of software.&lt;/p>
&lt;h2 id="origins">Origins&lt;/h2>
&lt;p>&lt;a href="https://github.com/BytewaveMLP/sleeti">sleeti&lt;/a> began in the summer of 2016 as an experiment in trying out &amp;ldquo;modern&amp;rdquo; PHP. I had never really delved into MVC all that much before; I had experimented, of course, but had never done anything in-depth with it. Larger frameworks like Symfony and Laravel looked so off-putting and complicated, but I still never completely dismissed the idea of proper OOP-based MVC frameworks. I just didn&amp;rsquo;t find the bells-and-whistles approach to things all that appealing. All the &amp;ldquo;magic&amp;rdquo; of bigger frameworks just seemed like a lot to learn for one 16-year-old kid in the late summer, so I never thought much of them. Plus, I&amp;rsquo;d done some work in Slim already thanks to some excellent tutorials from &lt;a href="https://www.youtube.com/user/phpacademy">Codecourse&lt;/a> (formerly PHPAcademy), which actually helped me lay out the groundwork for sleeti proper.&lt;/p>
&lt;p>I don&amp;rsquo;t exactly know when I started messing around with Slim, but I remember starting with Slim 2, so it was probably some time before December 2015. Around then, Slim 3 was released, and a little while later I picked up on the news. I was kind of obsessive about staying &amp;ldquo;up to date&amp;rdquo; on things, and wanted to start experimenting with version 3 as soon as possible. But I had a pretty big problem: a lack of learning resources. I caught a few things here and there from Codecourse, but nothing particularly useful or interesting (honestly, I didn&amp;rsquo;t have that many big ideas anyway).&lt;/p>
&lt;p>I remember being excited when Codecourse&amp;rsquo;s &lt;a href="https://www.youtube.com/watch?v=RhcQXFeor9g&amp;amp;list=PLfdtiltiRHWGc_yY90XRdq6mRww042aEC">&lt;em>Authentication with Slim 3&lt;/em>&lt;/a> series came out. My biggest complaint until then was that I&amp;rsquo;d wanted to do &lt;em>something&lt;/em>, but I wanted to move on from Slim 2, which I viewed as old now. Codecourse had released a &lt;a href="https://www.youtube.com/watch?v=YXKCNgfdAAM&amp;amp;list=PLfdtiltiRHWGKUvioJly40RJZchSG2-34">similar series for Slim 2&lt;/a>, which I&amp;rsquo;d really enjoyed setting up and using to learn, but I wanted to move on to Slim 3, and the &lt;em>Authentication with Slim 3&lt;/em> series made that easy. I built a small test project with the tutorial given, and that was that. I&amp;rsquo;d learned how to make an authentication system for Slim, and that&amp;rsquo;s about the only use I&amp;rsquo;d had for it.&lt;/p>
&lt;h2 id="eeti---a-mess-or-a-blessing">eeti - a mess, or a blessing?&lt;/h2>
&lt;p>Some time later, I came across eeti.me (&lt;strong>edit 2021-10-15:&lt;/strong> now defunct), a file sharing website made by a good friend of mine, &lt;a href="https://alexandra.moe/">Alex&lt;/a>. eeti was simple enough—a pomf.se clone which had evolved into its own application, complete with ShareX uploading support, an announcements page for, well, announcements, and even support for tying users' uploads back to their accounts. eeti worked, and I used it for quite a while as a file sharing service. I found little to complain about, and what little I did have, Alex (mostly) took care of.&lt;/p>
&lt;p>Eventually, I guess Alex got tired of my requests, and gave me access to the eeti source (which is now &lt;a href="https://github.com/BookHorseSoftware/eeti.me">public&lt;/a>!) when I asked. I don&amp;rsquo;t exactly remember what I had intended to add, but I do remember a lot of complaints. eeti.me, I found out, was a considerably-sized application built almost &lt;em>entirely&lt;/em> in procedural PHP. Sure, PHP was designed as a templating language, and in its early days mixing HTML + PHP was pretty commonplace. But to someone who had found MVC to be more appropriate for larger applications, the sight of all this procedural code brought about some (joking) teasing from me. I still give Alex a hard time about it, but hey, they have their reserves about MVC and I have mine about procedural code.&lt;/p>
&lt;h2 id="the-idea">The idea&lt;/h2>
&lt;p>Seeing eeti&amp;rsquo;s internals &lt;em>did&lt;/em> give me something, though: an idea. I&amp;rsquo;d always wanted to build &lt;em>something&lt;/em>, especially now with my new knowledge of Slim and MVC PHP, but I was never very good at coming up with ideas to work on. eeti gave me something to do: make a similar file-sharing site, but in &lt;em>my&lt;/em> favorite style using MVC PHP and Slim 3. So, I set out to do just that, using Codecourse&amp;rsquo;s Authentication series as the framework for what would become &lt;em>eeti Slim&lt;/em>.&lt;/p>
&lt;h2 id="eeti-slim---terribly-named-clunky-file-sharing">eeti Slim - terribly named, clunky file sharing&lt;/h2>
&lt;p>eeti Slim was the first iteration of sleeti, built in about a week or so. It&amp;rsquo;s hard to say when it was &amp;ldquo;complete,&amp;rdquo; though, as development never really stopped on eeti Slim. I was constantly adding new features, ranging from profile bios and Markdown support to a fully-featured admin and moderator control panel where higher-privileged users can moderate various parts of the site. I launched the first public build of eeti Slim on one of my friend&amp;rsquo;s server (I say server—really, it was just some desktop PC he had laying around (it was even a repurposed laptop at one point!)) in a late-night, very exhausting setup experience (which I would argue &lt;em>still&lt;/em> hasn&amp;rsquo;t improved all that much), which still exists today (&lt;strong>edit 2021-10-15L:&lt;/strong> now defunct), albeit on another server now. At the time it went live, filenames were stored by their ID and file extension, and were only associated to the user that uploaded them on profile pages. This made for some short links (i.e., &lt;code>http://example.com/viewfile/ID.EXT&lt;/code>), but my friend complained they lost meaningful detail in the filenames on occasion. I wasn&amp;rsquo;t quite sure why that mattered—eeti doesn&amp;rsquo;t do it, Imgur doesn&amp;rsquo;t do it, and really a lot of sites don&amp;rsquo;t do it. But I added it anyway, going for a very clunky approach of accessing files using links like &lt;code>http://example.com/viewfile/ID-FILENAME.EXT&lt;/code> which &lt;em>worked&lt;/em>, but felt incredibly silly in hindsight (Remember, at this time, file &lt;strong>links still weren&amp;rsquo;t tied to the user that uploaded the file&lt;/strong>, and so file IDs helped prevent duplicate filenames in both per-user and multi-user situations). Still, eeti Slim &lt;em>worked&lt;/em> for a while, even if it wasn&amp;rsquo;t perfect.&lt;/p>
&lt;h2 id="advancements">Advancements&lt;/h2>
&lt;p>eeti Slim never took off all that much initially, but that didn&amp;rsquo;t stop me. I kept adding new things to it, some of which came from my friend, and some my own imagination. I added a config handler (albeit a clunky JSON-based system that breaks if improperly set up). I added an admin control panel, where administrators could change various site settings and some of the underlying settings that made eeti Slim tick. I added a moderator control panel, where site moderators and administrators could view &lt;strong>all&lt;/strong> uploads and remove them if appropriate. I added file visibility options, allowing &lt;em>public&lt;/em> (anyone can view, and they appear on your profile), &lt;em>unlisted&lt;/em> (anyone can view with the link, but they don&amp;rsquo;t appear on your profile for anyone but you and moderators), and &lt;em>private&lt;/em> (no one but you and moderators can view) files. Eventually, eeti Slim was looking like a fully-featured site, but I still didn&amp;rsquo;t stop development there.&lt;/p>
&lt;h2 id="a-better-name">A better name&lt;/h2>
&lt;p>Around late September of that same year, I also renamed the project to sleeti. I don&amp;rsquo;t really know where I came up wit the idea, and I distinctly remember people telling me it was a silly name for sounding too much like &amp;ldquo;slutty&amp;rdquo;. But that really didn&amp;rsquo;t matter to me—eeti Slim had to go, and sleeti was the next best option. I liked the name, so I stuck with it.&lt;/p>
&lt;h2 id="client-filenames">Client filenames&lt;/h2>
&lt;p>At one point, I finally got called out on using file IDs in the URL by (again) my server-hosting friend. I was really hesitant to make the switch over to user-based file links (ie &lt;code>/viewfile/USERID/FILE.EXT&lt;/code>), mostly out of laziness. It would&amp;rsquo;ve been a big move for an established (yet low-traffic( site, and any modifications I made would &lt;em>have&lt;/em> to work or I&amp;rsquo;d break a production site with no real backup solution in place. Eventually, though, I broke and made the move, adding a (possibly inefficient) anti-duplicate setup that just appends a counter to the start of a filename if it&amp;rsquo;s found in that user&amp;rsquo;s uploads already. To maintain backwards compatibility with my production side, I had to write &lt;a href="https://github.com/BytewaveMLP/sleeti/issues/3">a clunky migration script&lt;/a> that isn&amp;rsquo;t very well-documented but serves its purpose, I suppose.&lt;/p>
&lt;h2 id="later-development">Later development&lt;/h2>
&lt;p>sleeti saw a number of useful enhancements and additions later on, ranging from support for logging and even two-factor authentication support. I added &amp;ldquo;remember me&amp;rdquo; functionality using what I remembered from Codecourse&amp;rsquo;s Slim 2 authentication series, and built some of it around Paragon Initiative&amp;rsquo;s &lt;a href="https://paragonie.com/blog/2015/04/secure-authentication-php-with-long-term-persistence#title.2.1">excellent blog post&lt;/a> on the subject of authentication and &amp;ldquo;remember me&amp;rdquo; functionality. I can actually attribute a lot of sleeti&amp;rsquo;s security improvements to Paragon, such as my session handling (which were even &lt;a href="https://github.com/BookHorseSoftware/eeti.me/commit/44333762eed0e2e33f23df457f0fd41c2e107fb4">added into eeti.me proper&lt;/a>. There were even a number of bug fixes to be had, some of which went better than &lt;a href="https://i.redd.it/7hy8xkhj0wox.png">others&lt;/a> (would you believe this was a server issue the whole time?).&lt;/p>
&lt;p>After this point, development wasn&amp;rsquo;t as much about fleshing out the site as it was adding new features and keeping things secure and stable. The site was basically feature-complete for a barebones file sharing service, and any new additions were just for fun or on request. I didn&amp;rsquo;t stop there, of course; sleeti was a learning experience for me, and I wanted to keep learning. But things slowed down until today, where most commits are just general bug fixes or small feature tweaks.&lt;/p>
&lt;h2 id="conclusion">Conclusion&lt;/h2>
&lt;p>I enjoyed working on sleeti, really. Sure, I had my share of ups and downs, but I learned a lot about &amp;ldquo;modern&amp;rdquo; PHP application development using MVC and routing, as well as templating and application security. There&amp;rsquo;s lots I would love to do to improve sleeti, but I feel I would need to build the site from scratch to add a lot of them. I also want to build something like sleeti in a more &amp;ldquo;proper&amp;rdquo; framework such as Laravel or Symfony, but it still seems like a daunting task to have to learn an entire framework. I still have lots I want to add to sleeti itself, too, such as proper account recovery and better administration over profiles, but as development languishes, so does my interest. School didn&amp;rsquo;t help much either, eating up a lot of my time for work and play, but I&amp;rsquo;m finally out now on summer vacation and am soon to be a senior (woo!).&lt;/p>
&lt;p>I&amp;rsquo;m really happy with what I did with sleeti. It&amp;rsquo;s by no means perfect, and it&amp;rsquo;s by no means &amp;ldquo;complete&amp;rdquo; in the sense that there&amp;rsquo;s nothing left to add. I&amp;rsquo;ll always find something to write or something to fix, but it&amp;rsquo;s on par with eeti, and that&amp;rsquo;s all that matters. I know I have a lot to learn still about PHP application development, but sleeti really helped me lay a good foundation for much larger future projects.&lt;/p></content></item></channel></rss>